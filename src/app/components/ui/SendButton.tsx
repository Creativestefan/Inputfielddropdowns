import { motion, AnimatePresence } from "motion/react";
import { ArrowUpIcon } from "../icons/InputIcons";

// ─── Custom waveform / voice icon ─────────────────────────────────────────────
function VoiceIcon() {
  return (
    <svg
      width={16}
      height={16}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M7.85797 3.00049C8.00519 3.00046 8.15164 3.02912 8.28766 3.08545C8.42357 3.14178 8.54691 3.22458 8.65094 3.32861C8.75498 3.43267 8.83779 3.55595 8.8941 3.69189C8.95037 3.82777 8.97903 3.97354 8.97906 4.12061V19.8784C8.97896 20.1756 8.86103 20.4603 8.65094 20.6704C8.4407 20.8806 8.15529 20.9995 7.85797 20.9995C7.5608 20.9994 7.27612 20.8806 7.06598 20.6704C6.85584 20.4603 6.73698 20.1756 6.73688 19.8784V4.12061C6.73691 3.97354 6.76654 3.82777 6.82281 3.69189C6.87914 3.55595 6.96192 3.43267 7.06598 3.32861C7.17005 3.22455 7.2933 3.14177 7.42926 3.08545C7.56516 3.02917 7.71088 3.00052 7.85797 3.00049ZM16.4527 3.00049C16.5999 3.00046 16.7464 3.02912 16.8824 3.08545C17.0183 3.14178 17.1416 3.22458 17.2457 3.32861C17.3497 3.43267 17.4325 3.55595 17.4888 3.69189C17.5451 3.82777 17.5738 3.97354 17.5738 4.12061V19.8784C17.5737 20.1756 17.4558 20.4603 17.2457 20.6704C17.0354 20.8806 16.75 20.9995 16.4527 20.9995C16.1555 20.9994 15.8708 20.8806 15.6607 20.6704C15.4506 20.4603 15.3317 20.1756 15.3316 19.8784V4.12061C15.3316 3.97354 15.3613 3.82777 15.4175 3.69189C15.4739 3.55595 15.5567 3.43267 15.6607 3.32861C15.7648 3.22455 15.888 3.14177 16.024 3.08545C16.1599 3.02917 16.3056 3.00052 16.4527 3.00049ZM2.9361 7.29736C3.08332 7.29734 3.22976 7.32697 3.36578 7.3833C3.50171 7.43963 3.62502 7.52242 3.72906 7.62646C3.83311 7.73053 3.91591 7.85379 3.97223 7.98975C4.02851 8.12564 4.05716 8.27138 4.05719 8.41846V15.5815C4.05715 15.7286 4.02852 15.8743 3.97223 16.0103C3.91591 16.1462 3.83311 16.2695 3.72906 16.3735C3.62504 16.4776 3.50169 16.5604 3.36578 16.6167C3.22977 16.673 3.08331 16.7026 2.9361 16.7026C2.78903 16.7026 2.64326 16.673 2.50739 16.6167C2.37146 16.5604 2.24815 16.4776 2.1441 16.3735C2.04005 16.2695 1.95727 16.1462 1.90094 16.0103C1.84465 15.8743 1.81602 15.7286 1.81598 15.5815V8.41846C1.81601 8.27138 1.84466 8.12564 1.90094 7.98975C1.95727 7.85379 2.04004 7.73053 2.1441 7.62646C2.24816 7.52241 2.37143 7.43963 2.50739 7.3833C2.64327 7.32703 2.78902 7.2974 2.9361 7.29736ZM12.1558 7.29736C12.303 7.29734 12.4486 7.32703 12.5845 7.3833C12.7206 7.43963 12.8447 7.52236 12.9488 7.62646C13.0528 7.73051 13.1357 7.85385 13.192 7.98975C13.2482 8.12562 13.2769 8.2714 13.2769 8.41846V15.5815C13.2768 15.8786 13.1587 16.1634 12.9488 16.3735C12.7386 16.5838 12.4531 16.7026 12.1558 16.7026C11.8585 16.7026 11.5731 16.5838 11.3629 16.3735C11.1529 16.1634 11.0348 15.8786 11.0347 15.5815V8.41846C11.0348 8.27139 11.0634 8.12563 11.1197 7.98975C11.176 7.85384 11.2589 7.73051 11.3629 7.62646C11.467 7.52236 11.5911 7.43963 11.7271 7.3833C11.8631 7.32704 12.0087 7.29734 12.1558 7.29736ZM20.7505 7.29736C20.8977 7.29736 21.0433 7.32701 21.1793 7.3833C21.3153 7.43963 21.4394 7.52236 21.5435 7.62646C21.6474 7.73043 21.7294 7.85397 21.7857 7.98975C21.842 8.12564 21.8716 8.27138 21.8716 8.41846V15.5815C21.8716 15.8786 21.7534 16.1634 21.5435 16.3735C21.3333 16.5837 21.0478 16.7026 20.7505 16.7026C20.4532 16.7026 20.1678 16.5838 19.9576 16.3735C19.7476 16.1634 19.6295 15.8786 19.6295 15.5815V8.41846C19.6295 8.27138 19.6581 8.12564 19.7144 7.98975C19.7707 7.85381 19.8536 7.73052 19.9576 7.62646C20.0617 7.52236 20.1858 7.43963 20.3218 7.3833C20.4578 7.32707 20.6035 7.29734 20.7505 7.29736Z"
        fill="white"
      />
    </svg>
  );
}

interface SendButtonProps {
  /** When true, shows the arrow-up (send) icon; when false, shows the mic */
  hasText: boolean;
  /** Kept for API compatibility — no longer drives icon state */
  appsActive?: boolean;
  onClick?: () => void;
}

const ICON_SPRING = {
  opacity: { duration: 0.12 },
  y: { type: "spring" as const, stiffness: 480, damping: 18, mass: 0.8 },
};

export function SendButton({ hasText, onClick }: SendButtonProps) {
  const showArrow = hasText;

  return (
    <button
      onClick={onClick}
      aria-label={showArrow ? "Send" : "Voice input"}
      className="flex items-center justify-center rounded-md shrink-0 size-[28px] hover:opacity-90 cursor-pointer overflow-hidden"
      style={{
        background: "linear-gradient(180deg, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0) 60%), var(--switch-active-bg)",
        boxShadow: "0px 1px 2px 0px rgba(0,0,0,0.05), 0px 0px 0px 1px var(--switch-active-bg)",
      }}
    >
      <AnimatePresence mode="wait" initial={false}>
        {showArrow ? (
          <motion.span
            key="arrow"
            initial={{ opacity: 0, y: 8 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -8 }}
            transition={ICON_SPRING}
            className="flex items-center justify-center"
          >
            <ArrowUpIcon />
          </motion.span>
        ) : (
          <motion.span
            key="mic"
            initial={{ opacity: 0, y: -8 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 8 }}
            transition={ICON_SPRING}
            className="flex items-center justify-center"
          >
            <VoiceIcon />
          </motion.span>
        )}
      </AnimatePresence>
    </button>
  );
}